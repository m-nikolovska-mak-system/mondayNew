name: Build Windows Installer

on:
  workflow_dispatch:
    inputs:
      jar-key:
        description: 'Cache key for JAR (e.g., jar-v1.0.0)'
        required: true

jobs:
  build-setup:
    runs-on: windows-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Restore cached JAR
        uses: actions/cache@v3
        with:
          path: build/libs/*.jar
          key: ${{ github.event.inputs.jar-key }}

      - name: List JAR files
        run: dir build\libs

      - name: Install Inno Setup
        run: choco install innosetup --no-progress -y

      - name: Build setup.exe
        run: |
          "C:\Program Files (x86)\Inno Setup 6\ISCC.exe" .github\setup-script.iss

      - name: Upload setup.exe
        uses: actions/upload-artifact@v4
        with:
          name: setup-installer
          path: output/setup.exe


      - name: Upload to GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          files: output/setup.exe
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

