name: Generate workflow docs

on:
  workflow_dispatch:
    inputs:
      file:
        description: 'Path to the workflow or action file (relative to repo root)'
        required: true
        default: .github/workflows/notify-app-changes-v3.yml
      output:
        description: 'Output markdown path (relative to repo root)'
        required: false
        default: docs/workflows.md
      title:
        description: 'Title to put in the markdown'
        required: false
        default: 'CI workflow docs'

jobs:
  build-doc:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Generate README with auto-doc
        uses: tj-actions/auto-doc@v3
        with:
          file: ${{ github.event.inputs.file }}
          output: ${{ github.event.inputs.output }}
          title: ${{ github.event.inputs.title }}
          # optional: include_yaml: true

      - name: Commit generated docs
        if: ${{ steps.generate_doc_outcome != 'failure' }}
        uses: EndBug/add-and-commit@v9
        with:
          author_name: github-actions[bot]
          author_email: 41898282+github-actions[bot]@users.noreply.github.com
          message: "chore(docs): update workflow docs for ${{ github.event.inputs.file }}"
          add: ${{ github.event.inputs.output }}
