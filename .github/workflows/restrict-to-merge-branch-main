name: Restrict.dev.Merges.Branch


on:
 pull_request:
   branches:
     - develop


jobs:
 restrict-to-merge-branch-develop:
   runs-on: ubuntu-latest


   steps:
     - name: Check merge branch
       if: github.event.pull_request.base.ref == 'develop'
       run: |
         ALLOWED_PATTERNS=("feature/*")
         BRANCH_ALLOWED=false
         for pattern in "${ALLOWED_PATTERNS[@]}"; do
           if [[ "${{ github.event.pull_request.head.ref }}" == $pattern ]]; then
             BRANCH_ALLOWED=true
             break
           fi
         done
         if [ "$BRANCH_ALLOWED" != true ]; then
           echo "Merges to develop are only allowed from branches matching patterns: ${ALLOWED_PATTERNS[*]}."
           exit 1
         fi
